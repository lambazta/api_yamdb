# API_YamDB

REST API для сервиса YaMDb — базы отзывов о фильмах, книгах и музыке.

Проект YaMDb собирает отзывы пользователей на произведения. Произведения делятся на категории: «Книги», «Фильмы», «Музыка».
Произведению может быть присвоен жанр. Новые жанры может создавать только администратор.
Читатели оставляют к произведениям текстовые отзывы и выставляют произведению рейтинг (оценку в диапазоне от одного до десяти).
Из множества оценок автоматически высчитывается средняя оценка произведения.

Аутентификация по JWT-токену

Поддерживает методы GET, POST, PUT, PATCH, DELETE

Предоставляет данные в формате JSON

## Стек технологий
- проект написан на Python с использованием Django REST Framework
- библиотека Simple JWT - работа с JWT-токеном
- библиотека django-filter - фильтрация запросов
- база данных - SQLite3
- система управления версиями - git

# Как запустить проект:

Клонировать репозиторий и перейти в него в командной строке:
```
git clone git@github.com:lambazta/api_yamdb.git
```
```
В созданной директории установите виртуальное окружение, активируйте его и установите необходимые зависимости:
```
python3 -m venv venv

. venv/bin/activate

pip install -r requirements.txt
```
Выполните миграции:
```
python manage.py migrate
```
Cоздайте суперпользователя:
```
python manage.py createsuperuser
```
Запустите сервер:
```
python manage.py runserver
```
__________________________________
##Импорт данных из csv-файла в базу данных

Код для импорта тестовой базы данных находится в файле: “api_yamdb\reviews\management\commands\import_data.py”

Импорт базы данных осуществляется командой:

“python manage.py import_data”

(Импорт необходимо осуществлять на чистую БД).

При наличии ошибок при импорте, необходимо сбросить все миграции и выполнить их повторно.
__________________________________
Ваш проект запустился на http://127.0.0.1:8000/

Полная документация доступна по адресу http://127.0.0.1:8000/redoc/

С помощью команды *pytest* вы можете запустить тесты и проверить работу модулей

## Алгоритм регистрации пользователей
- Пользователь отправляет запрос с параметрами *email* и *username* на */auth/signup/*.
- YaMDB отправляет письмо с кодом подтверждения (confirmation_code) на указаный *email* .
- Пользователь отправляет запрос с параметрами *email* и *confirmation_code* на */auth/token/*, в ответе на запрос ему приходит token (JWT-токен).

## Ресурсы API YaMDb

- Ресурс AUTH: аутентификация.
- Ресурс USERS: пользователи.
- Ресурс TITLES: произведения, к которым пишут отзывы (определённый фильм, книга или песня).
- Ресурс CATEGORIES: категории (типы) произведений («Фильмы», «Книги», «Музыка»).
- Ресурс GENRES: жанры произведений. Одно произведение может быть привязано к нескольким жанрам.
- Ресурс REVIEWS: отзывы на произведения. Отзыв привязан к определённому произведению.
- Ресурс COMMENTS: комментарии к отзывам. Комментарий привязан к определённому отзыву.

# Примеры запросов и ответов:

**Получение JWT-токена:**
POST http://127.0.0.1:8000/api/v1/auth/token/
```
{
  "username": "string",
  "confirmation_code": "string"
}
```
*Ответ 200 OK:*
```
{
  "token": "string"
}
```
**Получение списка всех произведений:**
GET http://127.0.0.1:8000/api/v1/titles/

*Ответ 200 OK:*
```
[
  {
    "count": 0,
    "next": "string",
    "previous": "string",
    "results": [
      {
        "id": 0,
        "name": "string",
        "year": 0,
        "rating": 0,
        "description": "string",
        "genre": [
          {
            "name": "string",
            "slug": "string"
          }
        ],
        "category": {
          "name": "string",
          "slug": "string"
        }
      }
    ]
  }
]
```
**Добавление произведения:**
POST http://127.0.0.1:8000/api/v1/titles/
```
{
    "name": "string",
    "year": 0,
    "description": "string",
    "genre": [
        "string"
    ],
"category": "string"
}
```
*Ответ 201 CREATED:* 
```
{
  "id": 0,
  "name": "string",
  "year": 0,
  "rating": 0,
  "description": "string",
  "genre": [
    {
      "name": "string",
      "slug": "string"
    }
  ],
  "category": {
    "name": "string",
    "slug": "string"
  }
}
```
**Частичное обновление отзыва по id:**
PATCH http://127.0.0.1:8000/api/v1/titles/{title_id}/reviews/{review_id}/
```
{
  "text": "string",
  "score": 1
}
```
*Ответ 200 OK:*
```
{
  "id": 0,
  "text": "string",
  "author": "string",
  "score": 1,
  "pub_date": "2019-08-24T14:15:22Z"
}
```
**Получение комментария к отзыву:**
GET http://127.0.0.1:8000/api/v1/titles/{title_id}/reviews/{review_id}/comments/{comment_id}/

*Ответ 200 OK:*
```
{
  "id": 0,
  "text": "string",
  "author": "string",
  "pub_date": "2019-08-24T14:15:22Z"
}
```
